<!DOCTYPE html>
<html>
<head>
<title>GlobalPinger</title>


<script src="https://cdn.jsdelivr.net/npm/chart.js@2/dist/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js"></script>
</head>

<body>


<p>Look ma, a graph!</p>

<canvas id="chartcanvas" width="640" height="480"></canvas>


<script>

function setupChart(chart_id, csv_path){
    var ctx=document.getElementById(chart_id).getContext("2d");

    var darray=[];

    var chart = new Chart(ctx, {
        type: 'scatter',

        data: {
            datasets: [{
                label: 'avg RTT',
                backgroundColor: 'rgb(255, 99, 132)',
                borderColor: 'rgb(255, 99, 132)',
                data: darray
            }]
        },

        options: {}
    });
    
    function dataToChart(datapoints){
    
            for (var i=0;i<datapoints.length;i++){
                console.log(datapoints[i]);
                darray.push({
                    'x':datapoints[i].timestamp,
                    'y':datapoints[i].rtt_avg
                });
                chart.update();
            }
        }

    Papa.parse(csv_path, {
        download: true,
        header:true,
        skipEmptyLines:true,
        complete: function(results) {
                console.log(results);
            
                datapoints=results.data;
                
                dataToChart(datapoints);
            }
    });
}

setupChart("chartcanvas", "data/8888.csv");


</script>
</body>

</html>
