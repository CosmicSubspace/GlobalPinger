<!DOCTYPE html>
<html>
<head>
<title>GlobalPinger</title>

<script src="https://cdn.jsdelivr.net/npm/moment@2/moment.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js@2/dist/Chart.min.js"></script>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.bundle.js"></script>-->

<!--<script src="https://cdn.jsdelivr.net/combine/npm/chart.js@2,npm/moment@2"></script>-->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js"></script>

<style>
.region{
font-weight: bold;
font-size:x-large;
}
.hostname{
font-family:monospace;
}
.instutution{}
</style>
</head>

<body>

<h1>Overseas Internet Congestion Monitor</h1>

<div id="korea">
<span class="region">Korea</span> <br>
<span class="institution">NeoWiz</span> <br>
<span class="hostname">ftp.neowiz.com</span>
<canvas class="chartcanvas" id="cc_neowiz" width="480" height="240"></canvas>
</div>

<div id="japan">
<span class="region">Japan</span> <br>
<span class="institution">JAIST</span> <br>
<span class="hostname">ftp.jaist.ac.jp</span>
<canvas class="chartcanvas" id="cc_jaist" width="480" height="240"></canvas>
</div>

<div id="china">
<span class="region">China</span> <br>
<span class="institution">DevCloud</span> <br>
<span class="hostname">mirrors.huaweicloud.com</span>
<canvas class="chartcanvas" id="cc_devcloud" width="480" height="240"></canvas>
</div>

<div id="singapore">
<span class="region">Singapore</span> <br>
<span class="institution">Andrew Yong</span> <br>
<span class="hostname">mirror.0x.sg</span>
<canvas class="chartcanvas" id="cc_ayong" width="480" height="240"></canvas>
</div>

<div id="usa_west">
<span class="region">USA - West</span> <br>
<span class="institution">University of California at Davis</span> <br>
<span class="hostname">mirror.math.ucdavis.edu</span>
<canvas class="chartcanvas" id="cc_ucdavis" width="480" height="240"></canvas>
</div>

<div id="usa_east">
<span class="region">USA - East</span> <br>
<span class="institution">University of Maryland</span> <br>
<span class="hostname">mirror.umd.edu</span>
<canvas class="chartcanvas" id="cc_umd" width="480" height="240"></canvas>
</div>

<div id="uk">
<span class="region">UK</span> <br>
<span class="institution">IT Services, University of Oxford</span> <br>
<span class="hostname">mirror.ox.ac.uk</span>
<canvas class="chartcanvas" id="cc_oxford" width="480" height="240"></canvas>
</div>

<div id="austraila">
<span class="region">Austraila</span> <br>
<span class="institution">Melbourne IT</span> <br>
<span class="hostname">ubuntu.melbourneitmirror.net</span>
<canvas class="chartcanvas" id="cc_melbournit" width="480" height="240"></canvas>
</div>

<div id="8888">
<span class="region">N/A</span> <br>
<span class="institution">Google DNS</span> <br>
<span class="hostname">8.8.8.8</span>
<canvas class="chartcanvas" id="cc_8888" width="480" height="240"></canvas>
</div>

<script>

function setupChart(chart_id, csv_path){
    var ctx=document.getElementById(chart_id).getContext("2d");

    var darray_rtt=[];
    var darray_lrate=[];

    var chart = new Chart(ctx, {
        type: 'scatter',


        data: {
            datasets: [{
                label: 'avg RTT',
                backgroundColor: '#22F',
                borderColor: '#22F',
                data: darray_rtt,
                yAxisID:"yax_rtt"
            },
            {
                label: 'Loss %',
                backgroundColor: '#F22',
                borderColor: '#F22',
                data: darray_lrate,
                yAxisID:"yax_lrate"
            }]
        },

        options: {
            responsive:false,
            scales: {
                xAxes: [{
                    type: 'time',
                    position: 'bottom',
                    time: {
                        unit:"hour",
                        stepSize:"1"
                    }
                }],
                yAxes: [
                    {
                        id:"yax_rtt",
                        type:"linear",
                        position:"left",
                        ticks:{
                            suggestedMin:0,
                            suggestedMax:400,
                            stepSize:100,
                            fontColor:"#22F"
                        }
                    },
                    {
                        id:"yax_lrate",
                        type:"linear",
                        position:"right",
                        ticks:{
                            suggestedMin:0,
                            suggestedMax:40,
                            stepSize:10,
                            fontColor:"#F22"
                        }
                    }
                ]
            }
        }
    });
    
    function dataToChart(datapoints){
            for (var i=0;i<datapoints.length;i++){
                console.log(datapoints[i]);
                var t=new Date(datapoints[i].timestamp*1000)
                darray_rtt.push({
                    'x':t,
                    'y':datapoints[i].rtt_avg
                });
                darray_lrate.push({
                    'x':t,
                    'y':datapoints[i].lossrate*100
                });
                chart.update();
            }
        }

    Papa.parse(csv_path, {
        download: true,
        header:true,
        skipEmptyLines:true,
        complete: function(results) {
                console.log(results);
            
                datapoints=results.data;
                
                dataToChart(datapoints);
            }
    });
}

setupChart("cc_neowiz", "adata/neowiz.csv");
setupChart("cc_jaist", "adata/jaist.csv");
setupChart("cc_devcloud", "adata/devcloud.csv");
setupChart("cc_ayong", "adata/ayong.csv");
setupChart("cc_ucdavis", "adata/ucdavis.csv");
setupChart("cc_umd", "adata/umd.csv");
setupChart("cc_oxford", "adata/oxford.csv");
setupChart("cc_melbournit", "adata/melbournit.csv");
setupChart("cc_8888", "adata/8888.csv");


</script>
</body>

</html>
